CREATE TABLE MEMBER(
    MEMBER_ID       VARCHAR2(20)    PRIMARY KEY,
    MEMBER_PW       VARCHAR2(20)    NOT NULL,
    MEMBER_NAME     VARCHAR2(15)    NOT NULL,
    MEMBER_NICK     VARCHAR2(30)    UNIQUE NOT NULL,
    PHONE           CHAR(13),
    MEMBER_BIRTH    CHAR(10),
    ENROLL_DATE     CHAR(10)
);
SELECT * FROM MEMBER;
INSERT INTO MEMBER VALUES ('user01', '1234', '유저01', '1111', '010-1111-1111', '2000-01-01', TO_CHAR(SYSDATE, 'YYYY-MM-DD'));
COMMIT;
INSERT INTO MEMBER VALUES ('user02', '1234', '유저02', '2222', '010-2222-2222', '1999-01-01', TO_CHAR(SYSDATE, 'YYYY-MM-DD'));
COMMIT;

/*
게시판
글번호, 제목, 내용, 조회수, 작성자, 작성일, 댓글수
파일테이블(게시글 첨부파일 저장용)
게시글번호 / 첨부파일
*/

SELECT * FROM BOARD;
SELECT * FROM BOARD_FILE;

CREATE TABLE BOARD(
    BOARD_NO        NUMBER          PRIMARY KEY,
    BOARD_TITLE     VARCHAR2(300)   NOT NULL,
    BOARD_CONTENT   VARCHAR2(1000)  NOT NULL,
    READ_COUNT      NUMBER          DEFAULT 0,
    BOARD_WRITER    VARCHAR2(20)    REFERENCES MEMBER(MEMBER_ID),
    REG_DATE        DATE            DEFAULT SYSDATE,
    COMMENT_COUNT   NUMBER          DEFAULT 0
);

CREATE TABLE BOARD_FILE(
    BOARD_NO        NUMBER          REFERENCES BOARD(BOARD_NO),
    FILENAME        VARCHAR2(300)
);
INSERT INTO BOARD VALUES(1, '제목1', '내용내용내용내용내용', DEFAULT, 'user01', SYSDATE, DEFAULT);
INSERT INTO BOARD_FILE VALUES(1, '첨부파일1');
INSERT INTO BOARD_FILE VALUES(1, '첨부파일2');
COMMIT;

INSERT INTO BOARD VALUES(2, '제목2', '내용내용내용내용내용2', DEFAULT, 'user02', SYSDATE, DEFAULT);
INSERT INTO BOARD_FILE VALUES(2, '첨부파일2-1');
INSERT INTO BOARD_FILE VALUES(2, '첨부파일2-2');
INSERT INTO BOARD_FILE VALUES(2, '첨부파일2-3');
INSERT INTO BOARD_FILE VALUES(2, '첨부파일2-4');
COMMIT;


/*
댓글
댓글번호, 내용, 작성자아이디, 글번호, 작성시간
*/

SELECT * FROM BOARD_COMMENT;

CREATE TABLE BOARD_COMMENT(
    BC_NO           NUMBER          PRIMARY KEY,
    BC_CONTENT      VARCHAR2(300)   NOT NULL,
    BC_WRITER       VARCHAR2(20)    REFERENCES MEMBER(MEMBER_ID),
    BOARD_NO        NUMBER          REFERENCES BOARD(BOARD_NO),
    BC_REG_DATE     DATE            DEFAULT SYSDATE
);
INSERT INTO BOARD_COMMENT VALUES (1, '등수놀이 제가1등', 'user01', 1, DEFAULT);
UPDATE BOARD SET COMMENT_COUNT = COMMENT_COUNT + 1 WHERE BOARD_NO = 1;
COMMIT;

INSERT INTO BOARD_COMMENT VALUES (2, '아 늦었네..', 'user02', 1, DEFAULT);
UPDATE BOARD SET COMMENT_COUNT = COMMENT_COUNT + 1 WHERE BOARD_NO = 1;
COMMIT;

ALTER TABLE BOARD DROP COLUMN COMMENT_COUNT;

SELECT BOARD_NO, BOARD_TITLE, READ_COUNT, BOARD_WRITER,
        (SELECT COUNT(*) FROM BOARD_COMMENT BC WHERE BC.BOARD_NO = B.BOARD_NO) COMMENT_COUNT
        FROM BOARD B;
        
INSERT INTO BOARD_COMMENT VALUES (3, '많이 늦었지 ㅎㅎ', 'user01', 1, DEFAULT);
COMMIT;


SELECT BC_NO, BC_CONTENT, MEMBER_NICK
FROM BOARD_COMMENT
JOIN MEMBER ON (BC_WRITER = MEMBER_ID);
